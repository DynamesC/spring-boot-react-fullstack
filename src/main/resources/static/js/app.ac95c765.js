(function(e){function t(t){for(var o,i,r=t[0],s=t[1],c=t[2],u=0,h=[];u<r.length;u++)i=r[u],Object.prototype.hasOwnProperty.call(l,i)&&l[i]&&h.push(l[i][0]),l[i]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);d&&d(t);while(h.length)h.shift()();return n.push.apply(n,c||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],o=!0,r=1;r<a.length;r++){var s=a[r];0!==l[s]&&(o=!1)}o&&(n.splice(t--,1),e=i(i.s=a[0]))}return e}var o={},l={app:0},n=[];function i(t){if(o[t])return o[t].exports;var a=o[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=o,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(a,o,function(t){return e[t]}.bind(null,o));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],s=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var d=s;n.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var o=a("85ec"),l=a.n(o);l.a},"0a89":function(e,t,a){"use strict";var o=a("6de9"),l=a.n(o);l.a},"12d7":function(e,t,a){},"37b3":function(e,t,a){e.exports=a.p+"img/yys_icon2.eba8e504.png"},"56d7":function(e,t,a){"use strict";a.r(t);a("e623"),a("e379"),a("5dc8"),a("37e1");var o=a("2b0e"),l=a("8c4f"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"login_container"},[a("div",{staticClass:"login_box"},[e._m(0),a("el-form",{ref:"loginFormRef",staticClass:"login_form",attrs:{"label-width":"0px",model:e.loginForm,rules:e.loginFormRules}},[a("el-form-item",{attrs:{prop:"username"}},[a("el-input",{attrs:{"prefix-icon":"el-icon-message"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1),a("el-form-item",{attrs:{prop:"password"}},[a("el-input",{attrs:{"prefix-icon":"el-icon-lock",type:"password"},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.login}},[e._v("Login")]),a("el-button",{attrs:{type:"info"},on:{click:e.resetLoginForm}},[e._v("Reset")])],1)],1)],1)])},i=[function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"avatar_box"},[o("img",{attrs:{src:a("37b3"),alt:""}})])}],r=a("bc3a").default,s={data:function(){return{loginForm:{username:"",password:""},loginFormRules:{username:[{required:!0,message:"username should not be null",trigger:"blur"}],password:[{required:!0,message:"password please",trigger:"blur"}]}}},methods:{resetLoginForm:function(){this.loginForm.username="",this.loginForm.password="",this.$refs.loginFormRef.resetFields()},loginFailed:function(){console.log("登录错误"),this.$message({message:"账号密码错误！",type:"error"})},loginSucceeded:function(e){window.sessionStorage.setItem("myToken",e.data.body.token),window.sessionStorage.setItem("userName",this.loginForm.username),this.$message({message:"登陆成功！",type:"success"}),console.log(window.sessionStorage.getItem("myToken")),A.push("/home")},login:function(){var e=this;this.$refs.loginFormRef.validate((function(t){if(console.log("login pressed"),t){var a={username:e.loginForm.username,password:e.loginForm.password},o=e;r.post("V1/Login",a).then((function(e){console.log(e.data.body.token),o.loginSucceeded(e)})).catch((function(e){console.log(e.response),o.loginFailed()}))}}))}}},c=s,d=(a("ff9e"),a("2877")),u=Object(d["a"])(c,n,i,!1,null,"24cf8a68",null),h=u.exports,p=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"hello"},[o("el-container",{staticStyle:{height:"100%",border:"0px solid #eee"},attrs:{direction:"vertical"}},[o("el-header",{staticStyle:{"text-align":"right","font-size":"12px",height:"140px"}},[o("el-avatar",{staticStyle:{position:"absolute",right:"240px",top:"40px",height:"50px",width:"50px",fit:"cover"},attrs:{size:e.large,src:a("8063")}}),o("img",{staticStyle:{width:"114px",height:"28px",position:"absolute",left:"40px",top:"50px"},attrs:{src:a("e38d")}}),o("div",{staticClass:"user_name_text"},[e._v(" zjwlk123 ")]),o("div",{staticClass:"user_role_text"},[e._v(" 管理员 ")]),o("el-button",{staticClass:"logout_button",staticStyle:{position:"absolute",top:"45px",right:"40px",width:"96px",height:"38px","border-radius":"10px"},attrs:{type:"info",icon:"el-icon-switch-button"},on:{click:e.logout}},[e._v("登出")])],1),o("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showAddChangeButton,expression:"showAddChangeButton"}],staticStyle:{position:"absolute",right:"40px",top:"130px","border-radius":"10px",height:"38px",width:"96px"},attrs:{type:"primary"},on:{click:e.changeAdClicked}},[e._v("更换广告")]),o("el-dialog",{attrs:{title:"更换广告",visible:e.showContentChangeDialog},on:{"update:visible":function(t){e.showContentChangeDialog=t}}},[o("el-form",{attrs:{model:e.form}},[o("el-form-item",{attrs:{label:"广告组","label-width":e.formLabelWidth}},[o("el-select",{attrs:{placeholder:"请选择广告"},model:{value:e.form.ad_index,callback:function(t){e.$set(e.form,"ad_index",t)},expression:"form.ad_index"}},e._l(e.ad_data_with_placeholder,(function(e){return o("el-option",{key:e.name,attrs:{label:e.name,value:e.index}})})),1)],1)],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.cancelAdChange}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:e.confirmAdChange}},[e._v("确 定")])],1)],1),o("el-tabs",{staticStyle:{"padding-left":"40px","padding-right":"40px"},on:{"tab-click":e.handleTabChange},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[o("el-tab-pane",{attrs:{label:"设备与场景",name:"tab_devices"}},[e.showTable?o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",attrs:{data:e.tableData,"tooltip-effect":"dark","row-class-name":e.rowStyle,"header-cell-style":{background:"#eef1f6",color:"#606266"}},on:{"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{fixed:"left",type:"selection",selectable:e.checkSelectable}}),o("el-table-column",{attrs:{prop:"id",label:"ID","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"connection_status",label:"在线状态","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"device_type",label:"设备类型","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"screen_size",label:"屏幕尺寸","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"gateway_mac",label:"所属网关","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"ad_name",label:"广告名称","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"action_count",label:"扫码次数","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"battery_level",label:"电量","show-overflow-tooltip":""}})],1):e._e()],1),o("el-tab-pane",{attrs:{label:"广告监测",name:"tab_ads_supervising"}},[e.showTable?o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.ad_table_loading,expression:"ad_table_loading"}],ref:"adTable",attrs:{data:e.ad_data_without_placeholder,"tooltip-effect":"dark","header-cell-style":{background:"#eef1f6",color:"#606266"}}},[o("el-table-column",{attrs:{prop:"id",label:"广告Id","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"name",label:"广告名","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"scan_count",label:"总扫码数","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"display_count",label:"当前设备数","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"last_scan_time",label:"最近扫码时间","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"last_24h_scan_time",label:"24小时扫码数","show-overflow-tooltip":""}})],1):e._e()],1)],1)],1)],1)},f=[],g=(a("4160"),a("45fc"),a("b0c0"),a("ac1f"),a("1276"),a("159b"),a("3835")),m=a("bc3a").default,b={name:"Home",props:{msg:String},created:function(){this.fetchData()},data:function(){return{showTable:!0,showContentChangeDialog:!1,showAddChangeButton:!0,ad_table_loading:!1,activeName:"tab_devices",headers:{Authorization:"Bearer "+window.sessionStorage.getItem("myToken")},tableData:[],labelMacs:[],ad_data_with_placeholder:[{index:-1,name:"请选择广告"}],ad_data_without_placeholder:[],loading:!0,multipleSelection:[],param_for_querying_labels:{page:1,size:1e3,storeUuid:"0108"},param_for_querying_gateways:{page:1,size:1e3,storeUuid:"0108"},form:{ad_index:-1},formLabelWidth:"120px"}},methods:{logout:function(){console.log("logout pressed"),window.sessionStorage.removeItem("myToken"),A.push("/login")},fetchData:function(){this.loading=!0;var e=this;function t(e){return function(t){var a=t.some((function(e){return e.error}));if(a)throw t;return e(t)}}m.all([m.post("V2/pub/label/query",this.param_for_querying_labels,{headers:this.headers,params:this.param_for_querying_labels}),m.get("V2/gateway",{headers:this.headers,params:this.param_for_querying_gateways})]).then(t((function(t){var a=Object(g["a"])(t,2),o=a[0],l=a[1];e.fetchLabelDataSucceeded(o),e.fetchGatewayDataSucceeded(l)}))).catch(m.spread((function(t,a){e.fetchLabelDataFailed(t),e.fetchGatewayDataFailed(a)}))),this.fetchAdList()},fetchLabelDataSucceeded:function(e){console.log("label fetching succeeded"),console.log(e.data);var t=e.data.body.list;console.log(t.length+" labels found");for(var a=this,o=0;o<t.length;o++){var l=t[o],n=l.mac;this.labelMacs.push(n);var i=l.battery,r=l.screenSize,s="离线",c="";null!=l.correspond&&(c=l.correspond.gatewayMac),"0"!=l.heartbeat&&(s="在线"),this.tableData.push({id:n,battery_level:i,screen_size:this.decodeScreenSize(r),device_type:"屏幕",connection_status:s,gateway_mac:c,ad_name:""})}a.fetchGoodsBinding(),this.loading=!1},fetchLabelDataFailed:function(e){null!=e&&(this.loading=!1,this.$message.error("设备信息拉取失败"),console.log("label fetching failed"))},decodeScreenSize:function(e){return"000c"===e?4.2:"000f"===e?5.83:"not defined"},fetchGatewayDataSucceeded:function(e){console.log("gateway fetching succeeded"),console.log(e.data);var t=e.data.list;console.log(t.length+" gateways found");for(var a=0;a<t.length;a++){var o=t[a],l=o.mac;this.tableData.push({id:l,connection_status:o.mode,device_type:"网关",screen_size:"N/A",battery_level:"N/A"})}this.loading=!1},fetchGatewayDataFailed:function(e){null!=e&&(this.loading=!1,this.$message.error("网关信息拉取失败"),console.log("gateway fetching failed"))},fetchAdList:function(){var e=this;m.get("/lp/get-ad-list",{baseURL:"http://81.68.165.124:8080/"}).then((function(t){console.log(t);for(var a=0;a<t.data.length;a++){var o=t.data[a],l=o.name,n=o.landingPageId,i=o.largeDemoId,r=o.smallDemoId;e.ad_data_with_placeholder.push({index:e.ad_data_with_placeholder.length-1,name:l}),e.ad_data_without_placeholder.push({index:e.ad_data_without_placeholder.length,id:n,name:l,small_demo_id:r,large_demo_id:i,temp_display_count:0,display_count:0})}}))},fetchGoodsBinding:function(){var e=this;console.log("fetch goods binding called");var t=[];function a(e){return function(t){var a=t.some((function(e){return e.error}));if(a)throw t;return e(t)}}for(var o=0;o<this.labelMacs.length;o++)t.push(m.get("/V2/label/query",{headers:this.headers,params:{mac:this.labelMacs[o]}}));m.all(t).then(a((function(t){console.log(t);for(var a=0;a<e.ad_data_without_placeholder.length;a++){var o=e.ad_data_without_placeholder[a];o.temp_display_count=0}for(var l=0;l<t.length;l++){var n=t[l];if(200==n.data.status){console.log(n);var i=n.data.body.id,r=n.data.body.label4,s=n.data.body.qrcode,c=s.substring(s.length-8,s.length),d=n.request.responseURL.split("=")[1];console.log("good result successfully fetched for "+d);for(var u=0;u<e.tableData.length;u++){var h=e.tableData[u];if(h.id==d){console.log(i.substring(0,i.length-12)),h.good_name=r,h.ad_name=r,h.good_info=n.data.body,h.ad_id=c;for(var p=0;p<e.ad_data_without_placeholder.length;p++){var f=e.ad_data_without_placeholder[p];if(f.id==h.ad_id){f.temp_display_count++;break}}break}}}}for(var g=0;g<e.ad_data_without_placeholder.length;g++){var m=e.ad_data_without_placeholder[g];m.display_count=m.temp_display_count,m.temp_display_count=0}e.reloadTable(),e.fetchActionCount()}))).catch(m.spread((function(e){console.log(e)})))},fetchActionCount:function(){var e=this;console.log("fetch action count called");var t=[];function a(e){return function(t){var a=t.some((function(e){return e.error}));if(a)throw t;return e(t)}}for(var o=0;o<e.tableData.length;o++){for(var l=e.tableData[o],n=l.id,i=l.ad_name,r="",s=0;s<e.ad_data_without_placeholder.length;s++){var c=e.ad_data_without_placeholder[s];if(i==c.name){r=c.id;break}}""!=r&&(t.push(m.get("/lp/get-action-count",{params:{adId:r,mac:n},baseURL:"http://81.68.165.124:8080/"})),m.all(t).then(a((function(t){console.log(t);for(var a=0;a<t.length;a++){var o=t[a];console.log(o);var l=o.request.responseURL.split("mac=")[1];l=l.split("&")[0],console.log(l);for(var n=0;n<e.tableData.length;n++){var i=e.tableData[n];i.id==l&&(i.action_count=o.data)}}e.reloadTable()}))).catch(m.spread((function(e){console.log(e)}))))}},fetchLabelTemplateBinding:function(){var e=this,t=[];function a(e){return function(t){var a=t.some((function(e){return e.error}));if(a)throw t;return e(t)}}for(var o=0;o<this.labelMacs.length;o++){var l=this.labelMacs[o];t.push(m.post("/V2/pub/binding/query",{mac:l},{headers:this.headers,params:{mac:l}}))}m.all(t).then(a((function(t){console.log(t);for(var a=0;a<t.length;a++){var o=t[a];if(console.log(o),431!=o.data.status){var l=o.data.body.templets[0].demoId,n=o.data.body.templets[0].demoName,i=o.request.responseURL.split("=")[1];console.log(i);for(var r=0;r<e.tableData.length;r++){var s=e.tableData[r];if(s.id==i){s.demo_id=l,s.demo_name=n;break}}e.reloadTable()}}}))).catch(m.spread((function(e){console.log(e)})))},fetchAdDetails:function(){var e=this;this.ad_table_loading=!0;for(var t=[],a=0;a<this.ad_data_without_placeholder.length;a++)t.push(m.get("/lp/get-ad-detail",{params:{adId:this.ad_data_without_placeholder[a].id},baseURL:"http://81.68.165.124:8080/"}));function o(e){return function(t){var a=t.some((function(e){return e.error}));if(a)throw t;return e(t)}}var l=this;m.all(t).then(o((function(t){console.log(t);for(var a=0;a<t.length;a++)for(var o=t[a],n=o.data.adId,i=0;i<l.ad_data_without_placeholder.length;i++){var r=l.ad_data_without_placeholder[i];if(r.id==n){r.scan_count=o.data.scanCount,r.last_24h_scan_time=o.data.scanCount24H,r.last_scan_time=o.data.lastScanTime;break}}l.ad_table_loading=!1,e.reloadTable()}))).catch(m.spread((function(e){console.log(e)})))},changeAdClicked:function(){console.log("changeAdClicked"),console.log("current selection: ",this.multipleSelection),0==this.multipleSelection.length?this.$message.error("请至少选择一个屏幕"):this.showContentChangeDialog=!0},cancelAdChange:function(){console.log("cancelAdChange"),this.showContentChangeDialog=!1,this.form.ad_index=-1},confirmAdChange:function(){if(this.showContentChangeDialog=!1,-1!=this.form.ad_index){for(var e=this.ad_data_without_placeholder[this.form.ad_index],t=[],a=0;a<this.multipleSelection.length;a++){var o=this.multipleSelection[a].id,l=e.small_demo_id;5.83==this.multipleSelection[a].screen_size&&(l=e.large_demo_id);var n="http://www.yys1.top/lp/ld?mac="+o+"&adId="+e.id;console.log(n),this.multipleSelection[a].good_info.qrcode=n,this.multipleSelection[a].good_info.label4=e.name,this.multipleSelection[a].good_info.label2=n;var i={information:this.multipleSelection[a].good_info,mac:o,demoId:l,storeUuid:"0108"};t.push(m.post("/V2/pub/binding/update",i,{headers:this.headers}))}var r=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),s=this;m.all(t).then(c((function(e){console.log(e),r.close(),s.fetchGoodsBinding()}))).catch(m.spread((function(e){console.log(e),r.close()}))),this.form.ad_index=-1}function c(e){return function(t){var a=t.some((function(e){return e.error}));if(a)throw t;return e(t)}}},reloadTable:function(){var e=this;this.showTable=!1,this.$nextTick((function(){e.showTable=!0}))},checkSelectable:function(e){return"网关"!=e.device_type&&"在线"==e.connection_status},toggleSelection:function(e){var t=this;e?e.forEach((function(e){t.$refs.multipleTable.toggleRowSelection(e)})):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(e){this.multipleSelection=e},handleTabChange:function(e,t){console.log(e),this.showAddChangeButton="tab_devices"==this.activeName,"tab_devices"==this.activeName?this.fetchGoodsBinding():"tab_ads_supervising"==this.activeName&&this.fetchAdDetails()},rowStyle:function(e){for(var t=e.row,a=(e.rowIndex,0);a<this.multipleSelection.length;a++)if(t.id===this.multipleSelection[a].id)return"selectedStyle"}}},_=b,v=(a("0a89"),Object(d["a"])(_,p,f,!1,null,"37b15874",null)),w=v.exports,y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"用户管理",name:"first"}},[e._v("1")]),a("el-tab-pane",{attrs:{label:"配置管理",name:"second"}},[e._v("2")]),a("el-tab-pane",{attrs:{label:"角色管理",name:"third"}},[e._v("3")]),a("el-tab-pane",{attrs:{label:"定时任务补偿",name:"fourth"}},[e._v("4")])],1)],1)],1)},x=[],S={data:function(){return{name:"test",activeName:"second"}},methods:{handleClick:function(e,t){console.log(e,t)}}},k=S,C=Object(d["a"])(k,y,x,!1,null,"4659ba96",null),D=C.exports;o["default"].use(l["a"]);var T=[{path:"",component:h,meta:{title:"登录-云云说后台"}},{path:"/login",component:h,meta:{title:"登录-云云说后台"}},{path:"/home",component:w,meta:{title:"主页-云云说后台"}},{path:"/test",component:D,meta:{title:"Test-云云说后台"}}],F=new l["a"]({routes:T});F.beforeEach((function(e,t,a){var o=window.sessionStorage.getItem("myToken");return"/login"===e.path?o?a(!1):(document.title=e.meta.title,a()):o?(document.title=e.meta.title,void a()):(document.title="登录-云云说后台",a("/login"))}));var A=F,L=a("bc3a"),$=a.n(L),I=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},N=[],O={name:"app",components:{}},j=O,q=(a("034f"),Object(d["a"])(j,I,N,!1,null,null,null)),R=q.exports,z=(a("aede"),a("a83d"),a("5c96")),M=a.n(z);o["default"].use(M.a),o["default"].config.productionTip=!1,$.a.defaults.baseURL="http://esl.ylwlesl.com:9191/",new o["default"]({router:A,render:function(e){return e(R)}}).$mount("#app")},"6de9":function(e,t,a){},8063:function(e,t,a){e.exports=a.p+"img/patrick.cd7ab461.png"},"85ec":function(e,t,a){},a83d:function(e,t,a){},aede:function(e,t,a){},e38d:function(e,t,a){e.exports=a.p+"img/yys_icon2_with_text.97a91cab.png"},ff9e:function(e,t,a){"use strict";var o=a("12d7"),l=a.n(o);l.a}});
//# sourceMappingURL=app.ac95c765.js.map