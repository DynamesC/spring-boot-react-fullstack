(function(e){function t(t){for(var o,i,s=t[0],r=t[1],c=t[2],h=0,u=[];h<s.length;h++)i=s[h],Object.prototype.hasOwnProperty.call(l,i)&&l[i]&&u.push(l[i][0]),l[i]=0;for(o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);d&&d(t);while(u.length)u.shift()();return n.push.apply(n,c||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],o=!0,s=1;s<a.length;s++){var r=a[s];0!==l[r]&&(o=!1)}o&&(n.splice(t--,1),e=i(i.s=a[0]))}return e}var o={},l={app:0},n=[];function i(t){if(o[t])return o[t].exports;var a=o[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=o,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(a,o,function(t){return e[t]}.bind(null,o));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],r=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var d=r;n.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var o=a("85ec"),l=a.n(o);l.a},"12d7":function(e,t,a){},"37b3":function(e,t,a){e.exports=a.p+"img/yys_icon2.eba8e504.png"},3989:function(e,t,a){"use strict";var o=a("dc6e"),l=a.n(o);l.a},"56d7":function(e,t,a){"use strict";a.r(t);a("e623"),a("e379"),a("5dc8"),a("37e1");var o=a("2b0e"),l=a("8c4f"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"login_container"},[a("div",{staticClass:"login_box"},[e._m(0),a("el-form",{ref:"loginFormRef",staticClass:"login_form",attrs:{"label-width":"0px",model:e.loginForm,rules:e.loginFormRules}},[a("el-form-item",{attrs:{prop:"username"}},[a("el-input",{attrs:{"prefix-icon":"el-icon-message"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1),a("el-form-item",{attrs:{prop:"password"}},[a("el-input",{attrs:{"prefix-icon":"el-icon-lock",type:"password"},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.login}},[e._v("Login")]),a("el-button",{attrs:{type:"info"},on:{click:e.resetLoginForm}},[e._v("Reset")])],1)],1)],1)])},i=[function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"avatar_box"},[o("img",{attrs:{src:a("37b3"),alt:""}})])}],s=a("bc3a").default,r={data:function(){return{loginForm:{username:"",password:""},loginFormRules:{username:[{required:!0,message:"username should not be null",trigger:"blur"}],password:[{required:!0,message:"password please",trigger:"blur"}]}}},methods:{resetLoginForm:function(){this.loginForm.username="",this.loginForm.password="",this.$refs.loginFormRef.resetFields()},loginFailed:function(){console.log("登录错误"),this.$message({message:"账号密码错误！",type:"error"})},loginSucceeded:function(e){window.sessionStorage.setItem("myToken",e.data.body.token),window.sessionStorage.setItem("userName",this.loginForm.username),this.$message({message:"登陆成功！",type:"success"}),console.log(window.sessionStorage.getItem("myToken")),N.push("/home")},login:function(){var e=this;this.$refs.loginFormRef.validate((function(t){if(console.log("login pressed"),t){var a={username:e.loginForm.username,password:e.loginForm.password},o=e;s.post("V1/Login",a).then((function(e){console.log(e.data.body.token),o.loginSucceeded(e)})).catch((function(e){console.log(e.response),o.loginFailed()}))}}))}}},c=r,d=(a("ff9e"),a("2877")),h=Object(d["a"])(c,n,i,!1,null,"24cf8a68",null),u=h.exports,p=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"hello"},[o("el-container",{staticStyle:{height:"100%",border:"0px solid #eee"},attrs:{direction:"vertical"}},[o("el-header",{staticStyle:{"text-align":"right","font-size":"12px",height:"140px"}},[o("el-avatar",{staticStyle:{position:"absolute",right:"240px",top:"40px",height:"50px",width:"50px",fit:"cover"},attrs:{src:a("8063")}}),o("img",{staticStyle:{width:"114px",height:"28px",position:"absolute",left:"40px",top:"50px"},attrs:{src:a("e38d")}}),o("div",{staticClass:"user_name_text"},[e._v(" zjwlk123 ")]),o("div",{staticClass:"user_role_text"},[e._v(" 管理员 ")]),o("el-button",{staticClass:"logout_button",staticStyle:{position:"absolute",top:"45px",right:"40px",width:"96px",height:"38px","border-radius":"10px"},attrs:{type:"info",icon:"el-icon-switch-button"},on:{click:e.logout}},[e._v("登出")])],1),o("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showAdChangeButton,expression:"showAdChangeButton"}],staticStyle:{position:"absolute",right:"40px",top:"130px","border-radius":"10px",height:"38px",width:"96px"},attrs:{type:"primary"},on:{click:e.changeAdClicked}},[e._v("更换广告")]),o("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showAdChangeButton,expression:"showAdChangeButton"}],staticClass:"delete_site_button",staticStyle:{position:"absolute",right:"150px",top:"130px","border-radius":"10px",height:"38px",width:"96px"},attrs:{type:"info"},on:{click:e.changeSiteClicked}},[e._v("更换站点")]),o("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showSiteManagementButtons,expression:"showSiteManagementButtons"}],staticClass:"delete_site_button",staticStyle:{position:"absolute",right:"150px",top:"130px","border-radius":"10px",height:"38px",width:"64px"},attrs:{type:"info"},on:{click:e.deleteSiteClicked}},[e._v("删除")]),o("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showSiteManagementButtons,expression:"showSiteManagementButtons"}],staticStyle:{position:"absolute",right:"40px",top:"130px","border-radius":"10px",height:"38px",width:"96px"},attrs:{type:"primary"},on:{click:e.addSiteClicked}},[e._v("添加站点")]),o("el-dialog",{attrs:{title:"更换广告",visible:e.showChangeAdDialog},on:{"update:visible":function(t){e.showChangeAdDialog=t}}},[o("el-form",{attrs:{model:e.form}},[o("el-form-item",{attrs:{label:"广告组","label-width":e.formLabelWidth}},[o("el-select",{attrs:{placeholder:"请选择广告"},model:{value:e.form.ad_index,callback:function(t){e.$set(e.form,"ad_index",t)},expression:"form.ad_index"}},e._l(e.ad_data_with_placeholder,(function(e){return o("el-option",{key:e.name,attrs:{label:e.name,value:e.index}})})),1)],1)],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.cancelAdChange}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:e.confirmAdChange}},[e._v("确 定")])],1)],1),o("el-dialog",{attrs:{title:"更换站点",visible:e.showChangeSiteDiaglog},on:{"update:visible":function(t){e.showChangeSiteDiaglog=t}}},[o("el-form",{attrs:{model:e.form}},[o("el-form-item",{attrs:{label:"站点","label-width":e.formLabelWidth}},[o("el-select",{attrs:{placeholder:"不分配"},model:{value:e.form.site_index,callback:function(t){e.$set(e.form,"site_index",t)},expression:"form.site_index"}},e._l(e.sites_data_with_placeholder,(function(e){return o("el-option",{key:e.name,attrs:{label:e.name,value:e.index}})})),1)],1)],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.cancelSiteChange}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:e.confirmSiteChange}},[e._v("确 定")])],1)],1),o("el-tabs",{staticStyle:{"padding-left":"40px","padding-right":"40px"},on:{"tab-click":e.handleTabChange},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[o("el-tab-pane",{attrs:{label:"设备管理",name:"tab_devices"}},[e.showTable?o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",attrs:{data:e.tableData,"tooltip-effect":"dark","row-class-name":e.rowStyle,"header-cell-style":{background:"#eef1f6",color:"#606266"}},on:{"selection-change":e.handleDeviceSelectionChange,"cell-click":e.deviceTableCellClicked,"cell-mouse-enter":e.deviceTableCellEntered,"cell-mouse-leave":e.deviceTableCellLeft}},[o("el-table-column",{attrs:{fixed:"left",type:"selection",selectable:e.checkDeviceSelectable}}),o("el-table-column",{attrs:{prop:"id",label:"ID","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"name",label:"名称","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.id==e.mouse_hover_device_table_row_id&&"名称"==e.mouse_hover_device_table_column_name&&"屏幕"==t.row.device_type?o("i",{staticClass:"el-icon-edit"}):e._e(),e._v(" "+e._s(t.row.name)+" ")]}}],null,!1,3569703046)}),o("el-table-column",{attrs:{prop:"connection_status",label:"在线状态","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"device_type",label:"设备类型","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"screen_size",label:"屏幕尺寸","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"gateway_mac",label:"所属网关","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"site_name",label:"所属站点","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"ad_name",label:"广告名称","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"action_count",label:"扫码次数","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"battery_level",label:"电量","show-overflow-tooltip":""}})],1):e._e()],1),o("el-tab-pane",{attrs:{label:"站点管理",name:"tab_sites"}},[e.showTable?o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.ad_table_loading,expression:"ad_table_loading"}],ref:"adTable",attrs:{data:e.sites_data_without_placeholder,"tooltip-effect":"dark","header-cell-style":{background:"#eef1f6",color:"#606266"}},on:{"selection-change":e.handleSiteSelectionChange,"cell-click":e.siteTableCellClicked,"cell-mouse-enter":e.siteTableCellEntered,"cell-mouse-leave":e.siteTableCellLeft}},[o("el-table-column",{attrs:{fixed:"left",type:"selection"}}),o("el-table-column",{attrs:{prop:"id",label:"站点ID","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"name",label:"站点名称","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.id==e.mouse_hover_site_table_row_id&&"站点名称"==e.mouse_hover_site_table_column_name?o("i",{staticClass:"el-icon-edit"}):e._e(),e._v(" "+e._s(t.row.name)+" ")]}}],null,!1,2287472251)}),o("el-table-column",{attrs:{prop:"device_count",label:"设备数量","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"scan_count",label:"扫码数量","show-overflow-tooltip":""}})],1):e._e()],1),o("el-tab-pane",{attrs:{label:"广告监测",name:"tab_ads_supervising"}},[e.showTable?o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.ad_table_loading,expression:"ad_table_loading"}],ref:"adTable",attrs:{data:e.ad_data_without_placeholder,"tooltip-effect":"dark","header-cell-style":{background:"#eef1f6",color:"#606266"}}},[o("el-table-column",{attrs:{prop:"id",label:"广告ID","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"name",label:"广告名","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"scan_count",label:"总扫码数","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"display_count",label:"当前设备数","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"last_scan_time",label:"最近扫码时间","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"last_24h_scan_time",label:"24小时扫码数","show-overflow-tooltip":""}})],1):e._e()],1)],1)],1)],1)},f=[],_=(a("4160"),a("45fc"),a("b0c0"),a("ac1f"),a("1276"),a("159b"),a("3835")),m=a("bc3a").default,g={name:"Home",props:{msg:String},created:function(){this.fetchData()},data:function(){return{mouse_hover_device_table_row_id:"NA",mouse_hover_device_table_column_name:"NA",mouse_hover_site_table_row_id:"NA",mouse_hover_site_table_column_name:"NA",showTable:!0,showChangeAdDialog:!1,showChangeSiteDiaglog:!1,showAdChangeButton:!0,showSiteManagementButtons:!1,ad_table_loading:!1,activeName:"tab_devices",headers:{Authorization:"Bearer "+window.sessionStorage.getItem("myToken")},tableData:[],labelMacs:[],sites_data_without_placeholder:[],sites_data_with_placeholder:[{index:-1,id:"NULL",name:"不分配"}],ad_data_with_placeholder:[{index:-1,name:"请选择广告"}],ad_data_without_placeholder:[],loading:!0,deviceSelection:[],siteSelection:[],param_for_querying_labels:{page:1,size:1e3,storeUuid:"0108"},param_for_querying_gateways:{page:1,size:1e3,storeUuid:"0108"},form:{ad_index:-1,site_index:-1},formLabelWidth:"120px"}},methods:{logout:function(){console.log("logout pressed"),window.sessionStorage.removeItem("myToken"),N.push("/login")},fetchData:function(){this.loading=!0;var e=this;function t(e){return function(t){var a=t.some((function(e){return e.error}));if(a)throw t;return e(t)}}m.all([m.post("V2/pub/label/query",this.param_for_querying_labels,{headers:this.headers,params:this.param_for_querying_labels}),m.get("V2/gateway",{headers:this.headers,params:this.param_for_querying_gateways})]).then(t((function(t){var a=Object(_["a"])(t,2),o=a[0],l=a[1];e.fetchLabelDataSucceeded(o),e.fetchGatewayDataSucceeded(l)}))).catch(m.spread((function(t,a){e.fetchLabelDataFailed(t),e.fetchGatewayDataFailed(a)}))),this.fetchAdList(),this.fetchSiteDetails()},fetchLabelDataSucceeded:function(e){console.log("label fetching succeeded"),console.log(e.data);var t=e.data.body.list;console.log(t.length+" labels found");for(var a=this,o=0;o<t.length;o++){var l=t[o],n=l.mac;this.labelMacs.push(n);var i=l.battery,s=l.screenSize,r="离线",c="";null!=l.correspond&&(c=l.correspond.gatewayMac),"0"!=l.heartbeat&&(r="在线"),this.tableData.push({id:n,battery_level:i,screen_size:this.decodeScreenSize(s),device_type:"屏幕",connection_status:r,gateway_mac:c,ad_name:""})}a.fetchGoodsBinding(),a.fetchLabelBackendData(),this.loading=!1},fetchLabelDataFailed:function(e){null!=e&&(this.loading=!1,this.$message.error("设备信息拉取失败"),console.log("label fetching failed"))},fetchSiteDetails:function(){var e=this;m.get("/lp/get-site-list",{baseURL:"http://81.68.165.124:8080/"}).then((function(t){console.log(t);var a=t.data;if(200==t.status){e.sites_data_without_placeholder=[],e.sites_data_with_placeholder=[{index:-1,id:"NULL",name:"不分配"}];for(var o=0;o<a.length;o++){var l=a[o];"NULL"!=l.siteId&&(e.sites_data_without_placeholder.push({index:e.sites_data_without_placeholder.length,id:l.siteId,name:l.name,device_count:l.deviceCount,scan_count:l.scanCount}),e.sites_data_with_placeholder.push({index:e.sites_data_with_placeholder.length-1,name:l.name}))}}}))},decodeScreenSize:function(e){return"000c"===e?4.2:"000f"===e?5.83:"not defined"},fetchGatewayDataSucceeded:function(e){console.log("gateway fetching succeeded"),console.log(e.data);var t=e.data.list;console.log(t.length+" gateways found");for(var a=0;a<t.length;a++){var o=t[a],l=o.mac;this.tableData.push({id:l,connection_status:o.mode,device_type:"网关",screen_size:"N/A",battery_level:"N/A"})}this.loading=!1},fetchGatewayDataFailed:function(e){null!=e&&(this.loading=!1,this.$message.error("网关信息拉取失败"),console.log("gateway fetching failed"))},fetchAdList:function(){var e=this;m.get("/lp/get-ad-list",{baseURL:"http://81.68.165.124:8080/"}).then((function(t){if(console.log(t),200==t.status){e.ad_data_with_placeholder=[{index:-1,name:"请选择广告"}],e.ad_data_without_placeholder=[];for(var a=0;a<t.data.length;a++){var o=t.data[a],l=o.name,n=o.landingPageId,i=o.largeDemoId,s=o.smallDemoId;e.ad_data_with_placeholder.push({index:e.ad_data_with_placeholder.length-1,name:l}),e.ad_data_without_placeholder.push({index:e.ad_data_without_placeholder.length,id:n,name:l,small_demo_id:s,large_demo_id:i,temp_display_count:0,display_count:0})}}}))},fetchGoodsBinding:function(){var e=this;console.log("fetch goods binding called");var t=[];function a(e){return function(t){var a=t.some((function(e){return e.error}));if(a)throw t;return e(t)}}for(var o=0;o<this.labelMacs.length;o++)t.push(m.get("/V2/label/query",{headers:this.headers,params:{mac:this.labelMacs[o]}}));m.all(t).then(a((function(t){console.log(t);for(var a=0;a<e.ad_data_without_placeholder.length;a++){var o=e.ad_data_without_placeholder[a];o.temp_display_count=0}for(var l=0;l<t.length;l++){var n=t[l];if(200==n.data.status){console.log(n);var i=n.data.body.id,s=n.data.body.label4,r=n.data.body.qrcode,c=r.substring(r.length-8,r.length),d=n.request.responseURL.split("=")[1];console.log("good result successfully fetched for "+d);for(var h=0;h<e.tableData.length;h++){var u=e.tableData[h];if(u.id==d){console.log(i.substring(0,i.length-12)),u.good_name=s,u.ad_name=s,u.good_info=n.data.body,u.ad_id=c;for(var p=0;p<e.ad_data_without_placeholder.length;p++){var f=e.ad_data_without_placeholder[p];if(f.id==u.ad_id){f.temp_display_count++;break}}break}}}}for(var _=0;_<e.ad_data_without_placeholder.length;_++){var m=e.ad_data_without_placeholder[_];m.display_count=m.temp_display_count,m.temp_display_count=0}e.reloadTable(),e.fetchActionCount()}))).catch(m.spread((function(e){console.log(e)})))},fetchLabelBackendData:function(){var e=this;console.log("fetchLabelBackendData called");var t=[];function a(e){return function(t){var a=t.some((function(e){return e.error}));if(a)throw t;return e(t)}}for(var o=0;o<e.tableData.length;o++){var l=e.tableData[o],n=l.id;"网关"!=l.device_type&&(t.push(m.get("/lp/get-label-detail",{params:{mac:n},baseURL:"http://81.68.165.124:8080/"})),m.all(t).then(a((function(t){console.log(t);for(var a=0;a<t.length;a++){var o=t[a];console.log(o);for(var l=o.data.name,n=o.data.siteName,i=o.data.siteId,s=o.data.mac,r=0;r<e.tableData.length;r++){var c=e.tableData[r];c.id!=s||(c.name=l,c.site_name=n,c.site_id=i)}}e.reloadTable()}))).catch(m.spread((function(e){console.log(e)}))))}},fetchActionCount:function(){var e=this;console.log("fetch action count called");var t=[];function a(e){return function(t){var a=t.some((function(e){return e.error}));if(a)throw t;return e(t)}}for(var o=0;o<e.tableData.length;o++){for(var l=e.tableData[o],n=l.id,i=l.ad_name,s="",r=0;r<e.ad_data_without_placeholder.length;r++){var c=e.ad_data_without_placeholder[r];if(i==c.name){s=c.id;break}}""!=s&&(t.push(m.get("/lp/get-action-count",{params:{adId:s,mac:n},baseURL:"http://81.68.165.124:8080/"})),m.all(t).then(a((function(t){console.log(t);for(var a=0;a<t.length;a++){var o=t[a];console.log(o);var l=o.request.responseURL.split("mac=")[1];l=l.split("&")[0],console.log(l);for(var n=0;n<e.tableData.length;n++){var i=e.tableData[n];i.id==l&&(i.action_count=o.data)}}e.reloadTable()}))).catch(m.spread((function(e){console.log(e)}))))}},fetchLabelTemplateBinding:function(){var e=this,t=[];function a(e){return function(t){var a=t.some((function(e){return e.error}));if(a)throw t;return e(t)}}for(var o=0;o<this.labelMacs.length;o++){var l=this.labelMacs[o];t.push(m.post("/V2/pub/binding/query",{mac:l},{headers:this.headers,params:{mac:l}}))}m.all(t).then(a((function(t){console.log(t);for(var a=0;a<t.length;a++){var o=t[a];if(console.log(o),431!=o.data.status){var l=o.data.body.templets[0].demoId,n=o.data.body.templets[0].demoName,i=o.request.responseURL.split("=")[1];console.log(i);for(var s=0;s<e.tableData.length;s++){var r=e.tableData[s];if(r.id==i){r.demo_id=l,r.demo_name=n;break}}e.reloadTable()}}}))).catch(m.spread((function(e){console.log(e)})))},fetchAdDetails:function(){var e=this;this.ad_table_loading=!0;for(var t=[],a=0;a<this.ad_data_without_placeholder.length;a++)t.push(m.get("/lp/get-ad-detail",{params:{adId:this.ad_data_without_placeholder[a].id},baseURL:"http://81.68.165.124:8080/"}));function o(e){return function(t){var a=t.some((function(e){return e.error}));if(a)throw t;return e(t)}}var l=this;m.all(t).then(o((function(t){console.log(t);for(var a=0;a<t.length;a++)for(var o=t[a],n=o.data.adId,i=0;i<l.ad_data_without_placeholder.length;i++){var s=l.ad_data_without_placeholder[i];if(s.id==n){s.scan_count=o.data.scanCount,s.last_24h_scan_time=o.data.scanCount24H,s.last_scan_time=o.data.lastScanTime;break}}l.ad_table_loading=!1,e.reloadTable()}))).catch(m.spread((function(e){console.log(e)})))},changeAdClicked:function(){console.log("changeAdClicked"),console.log("current selection: ",this.deviceSelection),0==this.deviceSelection.length?this.$message.error("请至少选择一个屏幕"):this.showChangeAdDialog=!0},cancelAdChange:function(){console.log("cancelAdChange"),this.showChangeAdDialog=!1,this.form.ad_index=-1},confirmAdChange:function(){if(this.showChangeAdDialog=!1,-1!=this.form.ad_index){for(var e=this.ad_data_without_placeholder[this.form.ad_index],t=[],a=0;a<this.deviceSelection.length;a++){var o=this.deviceSelection[a].id,l=e.small_demo_id;5.83==this.deviceSelection[a].screen_size&&(l=e.large_demo_id);var n="http://www.yys1.top/lp/ld?mac="+o+"&adId="+e.id;console.log(n),this.deviceSelection[a].good_info.qrcode=n,this.deviceSelection[a].good_info.label4=e.name,this.deviceSelection[a].good_info.label2=n;var i={information:this.deviceSelection[a].good_info,mac:o,demoId:l,storeUuid:"0108"};t.push(m.post("/V2/pub/binding/update",i,{headers:this.headers}))}var s=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),r=this;m.all(t).then(c((function(e){console.log(e),s.close(),r.fetchGoodsBinding()}))).catch(m.spread((function(e){console.log(e),s.close()}))),this.form.ad_index=-1}function c(e){return function(t){var a=t.some((function(e){return e.error}));if(a)throw t;return e(t)}}},changeSiteClicked:function(){0==this.deviceSelection.length?this.$message.error("请至少选择一个屏幕"):this.showChangeSiteDiaglog=!0},cancelSiteChange:function(){this.showChangeSiteDiaglog=!1,this.form.ad_index=-1},confirmSiteChange:function(){this.showChangeSiteDiaglog=!1;var e="NULL";-1!=this.form.site_index&&(e=this.sites_data_without_placeholder[this.form.site_index].id);for(var t=[],a=0;a<this.deviceSelection.length;a++)t.push(m.get("/lp/device-change-site",{baseURL:"http://81.68.165.124:8080/",params:{site_id:e,mac:this.deviceSelection[a].id}}));function o(e){return function(t){var a=t.some((function(e){return e.error}));if(a)throw t;return e(t)}}var l=this;m.all(t).then(o((function(e){console.log(e),l.fetchLabelBackendData()}))).catch(m.spread((function(e){console.log(e),l.fetchLabelBackendData()}))),this.form.ad_index=-1},addSiteClicked:function(){var e=this,t=this;this.$prompt("新站点名称","添加站点",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(a){var o=a.value;m.get("/lp/create-new-site",{baseURL:"http://81.68.165.124:8080/",params:{site_name:o}}).then((function(a){a.data&&(console.log(a),t.fetchSiteDetails(),e.$message({type:"success",message:"修改成功"}))}))}))},deleteSiteClicked:function(){var e=this,t=this;0!=this.siteSelection.length?this.$confirm("删除站点后，该站点内的设备将处于未分配状态, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var a=[];function o(e){return function(t){var a=t.some((function(e){return e.error}));if(a)throw t;return e(t)}}for(var l=0;l<e.siteSelection.length;l++){var n=e.siteSelection[l],i=n.id;a.push(m.get("/lp/delete-site",{baseURL:"http://81.68.165.124:8080/",params:{site_id:i}}))}m.all(a).then(o((function(e){t.fetchSiteDetails()}))).catch(m.spread((function(e){console.log(e),t.fetchSiteDetails()})))})).catch((function(){e.$message({type:"info",message:"已取消删除"})})):this.$message.error("请至少选择一个屏幕")},reloadTable:function(){var e=this;this.showTable=!1,this.$nextTick((function(){e.showTable=!0}))},deviceTableCellClicked:function(e,t,a,o){var l=this,n=e.id,i=this;this.mouse_hover_device_table_row_id==e.id&&"名称"==this.mouse_hover_device_table_column_name&&"屏幕"==e.device_type&&this.$prompt("新设备名称","修改设备名称",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(e){var t=e.value;console.log(n,t),m.get("/lp/update-device-name",{baseURL:"http://81.68.165.124:8080/",params:{mac:n,newName:t}}).then((function(e){e.data&&(console.log(e),i.fetchLabelBackendData(),l.$message({type:"success",message:"修改成功"}))}))}))},deviceTableCellEntered:function(e,t,a,o){this.mouse_hover_device_table_row_id=e.id,this.mouse_hover_device_table_column_name=t.label},deviceTableCellLeft:function(e,t,a,o){this.mouse_hover_device_table_row_id="NA",this.mouse_hover_device_table_column_name="NA"},siteTableCellClicked:function(e,t,a,o){var l=this,n=e.id,i=this;this.mouse_hover_site_table_row_id==e.id&&"站点名称"==this.mouse_hover_site_table_column_name&&this.$prompt("新站点名称","修改站点名称",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(e){var t=e.value;m.get("/lp/update-site-name",{baseURL:"http://81.68.165.124:8080/",params:{site_id:n,name:t}}).then((function(e){e.data&&(console.log(e),i.fetchSiteDetails(),l.$message({type:"success",message:"修改成功"}))}))}))},siteTableCellEntered:function(e,t,a,o){this.mouse_hover_site_table_row_id=e.id,this.mouse_hover_site_table_column_name=t.label},siteTableCellLeft:function(e,t,a,o){this.mouse_hover_site_table_row_id="NA",this.mouse_hover_site_table_column_name="NA"},checkDeviceSelectable:function(e){return"网关"!=e.device_type&&"在线"==e.connection_status},toggleSelection:function(e){var t=this;e?e.forEach((function(e){t.$refs.multipleTable.toggleRowSelection(e)})):this.$refs.multipleTable.clearSelection()},handleDeviceSelectionChange:function(e){this.deviceSelection=e},handleSiteSelectionChange:function(e){this.siteSelection=e},handleTabChange:function(e,t){console.log(e),this.showAdChangeButton="tab_devices"==this.activeName,this.showSiteManagementButtons="tab_sites"==this.activeName,"tab_devices"==this.activeName?this.fetchGoodsBinding():"tab_ads_supervising"==this.activeName?this.fetchAdDetails():"tab_sites"==this.activeName&&this.fetchSiteDetails()},rowStyle:function(e){for(var t=e.row,a=(e.rowIndex,0);a<this.deviceSelection.length;a++)if(t.id===this.deviceSelection[a].id)return"selectedStyle"}}},b=g,v=(a("3989"),Object(d["a"])(b,p,f,!1,null,"05e4e7ea",null)),w=v.exports,y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"用户管理",name:"first"}},[e._v("1")]),a("el-tab-pane",{attrs:{label:"配置管理",name:"second"}},[e._v("2")]),a("el-tab-pane",{attrs:{label:"角色管理",name:"third"}},[e._v("3")]),a("el-tab-pane",{attrs:{label:"定时任务补偿",name:"fourth"}},[e._v("4")])],1)],1)],1)},x=[],S={data:function(){return{name:"test",activeName:"second"}},methods:{handleClick:function(e,t){console.log(e,t)}}},C=S,k=Object(d["a"])(C,y,x,!1,null,"4659ba96",null),D=k.exports;o["default"].use(l["a"]);var T=[{path:"",component:u,meta:{title:"登录-云云说后台"}},{path:"/login",component:u,meta:{title:"登录-云云说后台"}},{path:"/home",component:w,meta:{title:"主页-云云说后台"}},{path:"/test",component:D,meta:{title:"Test-云云说后台"}}],L=new l["a"]({routes:T});L.beforeEach((function(e,t,a){var o=window.sessionStorage.getItem("myToken");return"/login"===e.path?o?a(!1):(document.title=e.meta.title,a()):o?(document.title=e.meta.title,void a()):(document.title="登录-云云说后台",a("/login"))}));var N=L,A=a("bc3a"),B=a.n(A),$=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},F=[],I={name:"app",components:{}},R=I,U=(a("034f"),Object(d["a"])(R,$,F,!1,null,null,null)),M=U.exports,O=(a("aede"),a("a83d"),a("5c96")),j=a.n(O);o["default"].use(j.a),o["default"].config.productionTip=!1,B.a.defaults.baseURL="http://esl.ylwlesl.com:9191/",new o["default"]({router:N,render:function(e){return e(M)}}).$mount("#app")},8063:function(e,t,a){e.exports=a.p+"img/patrick.cd7ab461.png"},"85ec":function(e,t,a){},a83d:function(e,t,a){},aede:function(e,t,a){},dc6e:function(e,t,a){},e38d:function(e,t,a){e.exports=a.p+"img/yys_icon2_with_text.97a91cab.png"},ff9e:function(e,t,a){"use strict";var o=a("12d7"),l=a.n(o);l.a}});
//# sourceMappingURL=app.5361c71a.js.map